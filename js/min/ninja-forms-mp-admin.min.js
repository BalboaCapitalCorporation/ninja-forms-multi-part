function nf_mp_change_page(e,t){if(!t){var t=""}nfPages.current_page=e;jQuery(".mp-page-nav").removeClass("active");jQuery("#ninja_forms_mp_page_"+e).addClass("active");var n=jQuery("#ninja_forms_field_list_"+e).position().left;jQuery("#ninja-forms-slide").animate({left:-n},"300",t)}function nf_mp_get_field_order(){jQuery("._page_divider-li").removeClass("not-sortable");jQuery(".ninja-forms-field-list").sortable("refresh");var e="";jQuery(".ninja-forms-field-list").each(function(){if(e!=""){e=e+","}e=e+jQuery(this).sortable("toArray")});e=e.split(",");var t={};for(var n=0;n<e.length;n++){t[n]=e[n]}jQuery("._page_divider-li").addClass("not-sortable");return JSON.stringify(t)}function nf_mp_remove_array_value(e){var t,n=arguments,r=n.length,i;while(r>1&&e.length){t=n[--r];while((i=e.indexOf(t))!==-1){e.splice(i,1)}}return e}var nfPage=Backbone.Model.extend({duplicate:function(){var e=ninja_forms_settings.form_id;nfFields.updateData();var t=JSON.stringify(nfFields.toJSON());jQuery(".mp-spinner").show();jQuery.post(ajaxurl,{form_id:e,field_ids:this.get("fields"),field_data:t,action:"nf_mp_copy_page",nf_ajax_nonce:ninja_forms_settings.nf_ajax_nonce},function(e){jQuery(".mp-spinner").hide();nfPages.add({num:e.new_part.num,divider_id:e.new_part.id,page_title:e.new_part.page_title,fields:e.new_part.fields});nfPages.count++;_.each(e.new_part.fields,function(e){nfFields.add({id:e,metabox_state:0})});nfPages.updateView(e.new_nav,e.new_slide,nfPages.count)})},remove:function(){var e=confirm(nf_mp.remove_page_text);if(e){var t=ninja_forms_settings.form_id;var n=this.get("num");var r=nfPages.count;if(r>1){jQuery("#ninja_forms_field_list_"+n).find("._page_divider-li").removeClass("not-sortable")}var i=this.get("fields");if(i.length>0){jQuery(".mp-remove-page").find(".symbol").hide();jQuery(".mp-remove-page").css("padding","4px 0 0 0");jQuery(".mp-remove-page").find(".spinner").show();if(n>1){move_to_page=n-1}else{move_to_page=1}var s=this;var o=nf_mp_get_field_order();jQuery.post(ajaxurl,{form_id:t,fields:i,move_to_page:move_to_page,order:o,action:"nf_mp_delete_page",nf_ajax_nonce:ninja_forms_settings.nf_ajax_nonce},function(e){jQuery(".mp-remove-page").find(".spinner").hide();jQuery(".mp-remove-page").css("padding","0");jQuery(".mp-remove-page").find(".symbol").show();nfPages.remove(s);var t=s.get("id");var n=nfFields.get(t);nfFields.remove(n);if(r==2){nfPages.reset();jQuery("._page_divider-li").remove();nfPages.updateView(e.new_nav,e.new_slide,1);jQuery("#ninja_forms_mp_pagination").fadeOut("fast");jQuery("#nf_mp_enable").fadeIn()}else{var i=1;_.each(nfPages.models,function(e){e.set("num",i);i++});nfPages.updateView(e.new_nav,e.new_slide,move_to_page)}nfPages.count--})}}}});var nfPages=Backbone.Collection.extend({model:nfPage,enable:function(){jQuery("#nf_mp_enable").fadeOut();var e=ninja_forms_settings.form_id;jQuery.post(ajaxurl,{form_id:e,action:"nf_mp_enable",nf_ajax_nonce:ninja_forms_settings.nf_ajax_nonce},function(e){_.each(e.new_parts,function(e){nfPages.add({num:e.num,divider_id:e.id,page_title:"",fields:e.fields});nfFields.add({id:e.id,metabox_state:0})});nfPages.count=2;nfPages.updateView(e.new_nav,e.new_slide,1)})},addNew:function(){jQuery(".mp-add-page").find(".symbol").hide();jQuery(".mp-add-page").css("padding","4px 0 0 0");jQuery(".mp-add-page").find(".spinner").show();nfFields.updateData();var e=ninja_forms_settings.form_id;var t=this;var n=nf_mp_get_field_order();jQuery.post(ajaxurl,{form_id:e,order:n,action:"nf_mp_new_page",nf_ajax_nonce:ninja_forms_settings.nf_ajax_nonce},function(e){t.count++;t.add([{num:t.count,fields:e.new_part.fields,divider_id:e.new_part.id}]);nfFields.add({id:e.new_part.id,metabox_state:0});t.updateView(e.new_nav,e.new_slide,nfPages.count);jQuery(document).triggerHandler("nfMpAddPart",[e]);jQuery(".mp-add-page").find(".spinner").hide();jQuery(".mp-add-page").find(".symbol").show()})},updateView:function(e,t,n){jQuery("#ninja_forms_mp_pagination").html(e);jQuery("#ninja-forms-slide").html(t);this.updateSortables();jQuery("#ninja_forms_mp_pagination").fadeIn();if(false!=n){nf_mp_change_page(n)}},updateSortables:function(){jQuery(".ninja-forms-field-list").sortable({handle:".menu-item-handle",items:"li:not(.not-sortable)",connectWith:".ninja-forms-field-list",start:function(e,t){var n=jQuery(t.item).find(".wp-editor-wrap").length;if(n>0){jQuery(t.item).find(".wp-editor-wrap").each(function(){var e=this.id.replace("wp-","");e=e.replace("-wrap","");tinyMCE.execCommand("mceRemoveControl",false,e)})}},stop:function(e,t){var n=jQuery(t.item).find(".wp-editor-wrap").length;if(n>0){jQuery(t.item).find(".wp-editor-wrap").each(function(){var e=this.id.replace("wp-","");e=e.replace("-wrap","");tinyMCE.execCommand("mceAddControl",true,e)})}jQuery(this).sortable("refresh")}});jQuery(".mp-add-page").droppable({accept:".ninja-forms-field-list li",hoverClass:"drop-hover",tolerance:"pointer",drop:function(e,t){var n=t.draggable;jQuery(document).on("nfMpAddPart.drop",function(e){n.hide("slow",function(){jQuery(this).appendTo("#ninja_forms_field_list_"+nfPages.count).show("slow")})});nfPages.addNew()}});jQuery("#mp-page-list").sortable({helper:"clone",tolerance:"pointer",update:function(e,t){var n=false;jQuery("#mp-page-list li").each(function(e){var t=e+1;var r=jQuery(this).data("page");jQuery(this).data("page",t);jQuery(this).html(t);jQuery(this).prop("id","ninja_forms_mp_page_"+t);nfPages.findWhere({num:r}).set("new_num",t);jQuery("#ninja_forms_field_list_"+r).data("page",t);if(nfPages.current_page==r&&!n){nfPages.current_page=t;n=true}});nfPages.each(function(e){var t=e.get("num");var n=e.get("new_num");e.set("num",n);e.unset("new_num")});var r=jQuery("#ninja-forms-slide");uls=r.children("ul");uls.each(function(e){var t=jQuery(this).data("page");jQuery(this).prop("id","ninja_forms_field_list_"+t)});uls.detach().sort(function(e,t){return jQuery(e).data("page")-jQuery(t).data("page")});r.append(uls);nf_mp_change_page(nfPages.current_page)}});jQuery("#mp-page-list").disableSelection();jQuery(".mp-page-nav").droppable({accept:".ninja-forms-field-list li",hoverClass:"drop-hover",tolerance:"pointer",drop:function(e,t){var n=jQuery(this).data("page");t.draggable.hide("slow",function(){jQuery(this).appendTo("#ninja_forms_field_list_"+n).show("slow")})}})}});var nfPages=new nfPages;jQuery(document).ready(function(e){nfPages.current_page=1;nfPages.count=1;if("undefined"!==typeof nf_mp.pages){var t=1;_.each(nf_mp.pages,function(e){nfPages.add({num:t,divider_id:e.id,page_title:e.page_title,fields:e.fields});t++});nfPages.count=t-1}e(document).on("click",".mp-add-page",function(e){e.preventDefault();nfPages.addNew()});e(document).on("click","#nf_mp_enable",function(e){e.preventDefault();nfPages.enable()});e(document).on("click",".mp-page-nav",function(t){var n=e(this).data("page");var r=nfPages.current_page;if(n!=r){nf_mp_change_page(n)}});e(document).on("click",".mp-remove-page",function(e){var t=nfPages.current_page;var n=nfPages.findWhere({num:t});n.remove()});e(document).on("nfAdminSaveFields.mpFilter",function(t){e("._page_divider-li").removeClass("not-sortable");e(".ninja-forms-field-list").sortable("refresh");var n="";e(".ninja-forms-field-list").each(function(){if(n!=""){n=n+","}n=n+e(this).sortable("toArray")});n=n.split(",");var r={};for(var i=0;i<n.length;i++){r[i]=n[i]}r=JSON.stringify(r);e(document).data("field_order",r)});e(document).off("addField.default");e(document).on("addField.mpAdd",function(e,t){var n=nfPages.current_page;jQuery("#ninja_forms_field_list_"+n).append(t.new_html);if(t.new_type=="List"){jQuery(".ninja-forms-field-list-options").sortable({helper:"clone",handle:".ninja-forms-drag",items:"div",placeholder:"ui-state-highlight"})}if(typeof nf_ajax_rte_editors!=="undefined"){for(var r=nf_ajax_rte_editors.length-1;r>=0;r--){var i=nf_ajax_rte_editors[r];tinyMCE.init(tinyMCEPreInit.mceInit[i]);try{quicktags(tinyMCEPreInit.qtInit[i])}catch(e){}}}nfFields.add({id:t.new_id,metabox_state:1});var s=nfPages.findWhere({num:n});var o=s.get("fields");o.push(t.new_id.toString());s.set("fields",o)});e(document).on("removeField",function(e,t){var n=nfPages.findWhere({num:nfPages.current_page});if("undefined"!==typeof n){var r=n.get("fields");r=nf_mp_remove_array_value(r,t);n.set("fields",r)}});e(document).on("click",".mp-copy-page",function(e){e.preventDefault();var t=nfPages.current_page;var n=nfPages.findWhere({num:t});n.duplicate()});e("#mp-page-list").disableSelection();nfPages.updateSortables()})