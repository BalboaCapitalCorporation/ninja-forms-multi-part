!function(){var e,t,n;!function(i){function r(e,t){return b.call(e,t)}function l(e,t){var n,i,r,l,o,a,s,c,d,u,f,h=t&&t.split("/"),g=C.map,p=g&&g["*"]||{};if(e&&"."===e.charAt(0))if(t){for(e=e.split("/"),o=e.length-1,C.nodeIdCompat&&j.test(e[o])&&(e[o]=e[o].replace(j,"")),e=h.slice(0,h.length-1).concat(e),d=0;d<e.length;d+=1)if(f=e[d],"."===f)e.splice(d,1),d-=1;else if(".."===f){if(1===d&&(".."===e[2]||".."===e[0]))break;d>0&&(e.splice(d-1,2),d-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((h||p)&&g){for(n=e.split("/"),d=n.length;d>0;d-=1){if(i=n.slice(0,d).join("/"),h)for(u=h.length;u>0;u-=1)if(r=g[h.slice(0,u).join("/")],r&&(r=r[i])){l=r,a=d;break}if(l)break;!s&&p&&p[i]&&(s=p[i],c=d)}!l&&s&&(l=s,a=c),l&&(n.splice(0,a,l),e=n.join("/"))}return e}function o(e,t){return function(){var n=w.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),h.apply(i,n.concat([e,t]))}}function a(e){return function(t){return l(t,e)}}function s(e){return function(t){m[e]=t}}function c(e){if(r(v,e)){var t=v[e];delete v[e],y[e]=!0,f.apply(i,t)}if(!r(m,e)&&!r(y,e))throw new Error("No "+e);return m[e]}function d(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function u(e){return function(){return C&&C.config&&C.config[e]||{}}}var f,h,g,p,m={},v={},C={},y={},b=Object.prototype.hasOwnProperty,w=[].slice,j=/\.js$/;g=function(e,t){var n,i=d(e),r=i[0];return e=i[1],r&&(r=l(r,t),n=c(r)),r?e=n&&n.normalize?n.normalize(e,a(t)):l(e,t):(e=l(e,t),i=d(e),r=i[0],e=i[1],r&&(n=c(r))),{f:r?r+"!"+e:e,n:e,pr:r,p:n}},p={require:function(e){return o(e)},exports:function(e){var t=m[e];return"undefined"!=typeof t?t:m[e]={}},module:function(e){return{id:e,uri:"",exports:m[e],config:u(e)}}},f=function(e,t,n,l){var a,d,u,f,h,C,b=[],w=typeof n;if(l=l||e,"undefined"===w||"function"===w){for(t=!t.length&&n.length?["require","exports","module"]:t,h=0;h<t.length;h+=1)if(f=g(t[h],l),d=f.f,"require"===d)b[h]=p.require(e);else if("exports"===d)b[h]=p.exports(e),C=!0;else if("module"===d)a=b[h]=p.module(e);else if(r(m,d)||r(v,d)||r(y,d))b[h]=c(d);else{if(!f.p)throw new Error(e+" missing "+d);f.p.load(f.n,o(l,!0),s(d),{}),b[h]=m[d]}u=n?n.apply(m[e],b):void 0,e&&(a&&a.exports!==i&&a.exports!==m[e]?m[e]=a.exports:u===i&&C||(m[e]=u))}else e&&(m[e]=n)},e=t=h=function(e,t,n,r,l){if("string"==typeof e)return p[e]?p[e](t):c(g(e,t).f);if(!e.splice){if(C=e,C.deps&&h(C.deps,C.callback),!t)return;t.splice?(e=t,t=n,n=null):e=i}return t=t||function(){},"function"==typeof n&&(n=r,r=l),r?f(i,e,t,n):setTimeout(function(){f(i,e,t,n)},4),h},h.config=function(e){return h(e)},e._defined=m,n=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),r(m,e)||r(v,e)||(v[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("../lib/almond",function(){}),n("models/partModel",[],function(){var e=Backbone.Model.extend({defaults:{formContentData:[],order:0,type:"part"},initialize:function(){this.get("title")||this.set("title","Part Title"),this.filterFormContentData(),this.listenTo(this.get("formContentData"),"change:order",this.sortFormContentData);var e=i.channel("fields").request("get:collection");this.listenTo(e,"remove",this.triggerRemove)},sortFormContentData:function(){this.get("formContentData").sort()},triggerRemove:function(e){jQuery.isArray(this.get("formContentData"))&&this.filterFormContentData(),this.get("formContentData").trigger("remove:field",e)},filterFormContentData:function(){var e=i.channel("formContent").request("get:loadFilters"),t=_.without(e,void 0),n=t[1];this.set("formContentData",n(this.get("formContentData")))}});return e}),n("models/partCollection",["models/partModel"],function(e){var t=Backbone.Collection.extend({model:e,currentElement:!1,comparator:"order",initialize:function(e,t){e=e||[],this.on("remove",this.changeCurrentPart),this.on("remove",this.maybeChangeBuilderClass),this.on("add",this.maybeChangeBuilderClass),this.maybeChangeBuilderClass(e.length)},maybeChangeBuilderClass:function(e,t,n){!0==e instanceof Backbone.Model&&(e=this.length),this.changeBuilderClass(e>1)},changeBuilderClass:function(e){var t=i.channel("app").request("get:builderEl");e?jQuery(t).addClass("nf-has-parts"):jQuery(t).removeClass("nf-has-parts")},changeCurrentPart:function(e,t,n){this.getElement()==e?0==n.index?this.setElement(this.at(0)):this.setElement(this.at(n.index-1)):1==this.length&&this.setElement(this.at(0))},append:function(e){e=e||{};var t=this.length-1;return e=_.extend({order:t},e),this.add(e)},getElement:function(){return this.currentElement||this.setElement(this.at(0),!0),this.currentElement},setElement:function(e,t){t=t||!1,this.previousElement=this.currentElement,this.currentElement=e,t||this.trigger("change:part",this)},next:function(){return this.hasNext()&&this.setElement(this.at(this.indexOf(this.getElement())+1)),this},previous:function(){return this.hasPrevious()&&this.setElement(this.at(this.indexOf(this.getElement())-1)),this},hasNext:function(){return 0==this.length?!1:this.length-1!=this.indexOf(this.getElement())},hasPrevious:function(){return 0==this.length?!1:0!=this.indexOf(this.getElement())},getFormContentData:function(){return this.getElement().get("formContentData")}});return t}),n("controllers/data",["models/partCollection"],function(e){var t=Marionette.Object.extend({initialize:function(){i.channel("mp").reply("init:partCollection",this.initPartCollection,this),i.channel("mp").reply("get:collection",this.getCollection,this),this.listenTo(i.channel("fields"),"add:field",this.addField)},initPartCollection:function(e){this.collection=e},getCollection:function(){return this.collection},addField:function(e){this.collection.getFormContentData().trigger("add:field",e),1==this.collection.getFormContentData().length&&this.collection.getFormContentData().trigger("reset")}});return t}),n("controllers/clickControls",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("mp"),"click:previous",this.clickPrevious),this.listenTo(i.channel("mp"),"click:next",this.clickNext),this.listenTo(i.channel("mp"),"click:new",this.clickNew)},clickPrevious:function(e){var t=i.channel("mp").request("get:collection");t.previous()},clickNext:function(e){var t=i.channel("mp").request("get:collection");t.next()},clickNew:function(e){var t=i.channel("mp").request("get:collection"),n=t.append();t.setElement(n);var r=i.channel("mp").request("get:settingGroupCollection");i.channel("app").request("open:drawer","editSettings",{model:t.getElement(),groupCollection:r})}});return e}),n("controllers/gutterDroppables",[],function(){var e=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("mp"),"over:gutter",this.over),this.listenTo(i.channel("mp"),"out:gutter",this.out),this.listenTo(i.channel("mp"),"drop:rightGutter",this.dropRight),this.listenTo(i.channel("mp"),"drop:leftGutter",this.dropLeft)},over:function(e,t){jQuery("#nf-main").find(".nf-fields-sortable-placeholder").addClass("nf-sortable-removed").removeClass("nf-fields-sortable-placeholder"),e.item=e.draggable,i.channel("app").request("over:fieldsSortable",e)},out:function(e,t){jQuery("#nf-main").find(".nf-sortable-removed").addClass("nf-fields-sortable-placeholder"),e.item=e.draggable,i.channel("app").request("out:fieldsSortable",e)},drop:function(e,t,n){e.draggable.dropping=!0,e.item=e.draggable,i.channel("app").request("out:fieldsSortable",e),i.channel("fields").request("sort:fields",null,null,!1)},dropLeft:function(e,t){if(this.drop(e,t,"left"),t.hasPrevious())if(jQuery(e.draggable).hasClass("nf-field-wrap")){var n=i.channel("fields").request("get:field",jQuery(e.draggable).data("id"));t.getFormContentData().trigger("remove:field",n),t.at(t.indexOf(t.getElement())-1).get("formContentData").trigger("append:field",n)}else if(jQuery(e.draggable).hasClass("nf-field-type-draggable")){var r=jQuery(e.draggable).data("id"),n=this.addField(r,t);t.at(t.indexOf(t.getElement())-1).get("formContentData").trigger("append:field",n)}else{i.channel("fields").request("sort:staging");var l=i.channel("fields").request("get:staging");_.each(l.models,function(e,n){var i=this.addField(e.get("slug"),t);t.at(t.indexOf(t.getElement())-1).get("formContentData").trigger("append:field",i)},this),i.channel("fields").request("clear:staging")}},dropRight:function(e,t){if(this.drop(e,t),jQuery(e.draggable).hasClass("nf-field-wrap")){var n=i.channel("fields").request("get:field",jQuery(e.draggable).data("id"));if(t.hasNext())t.getFormContentData().trigger("remove:field",n),t.at(t.indexOf(t.getElement())+1).get("formContentData").trigger("append:field",n);else{t.getFormContentData().trigger("remove:field",n);var r=t.append({formContentData:[n.get("key")]});t.setElement(r)}}else{if(jQuery(e.draggable).hasClass("nf-field-type-draggable")){var l=jQuery(e.draggable).data("id"),n=this.addField(l,t);if(t.hasNext())return t.at(t.indexOf(t.getElement())+1).get("formContentData").trigger("append:field",n),!1;var r=t.append({formContentData:[n.get("key")]});return t.setElement(r),r}i.channel("fields").request("sort:staging");var o=i.channel("fields").request("get:staging"),a=[];if(_.each(o.models,function(e,n){var i=this.addField(e.get("slug"),t);t.hasNext()?t.at(t.indexOf(t.getElement())+1).get("formContentData").trigger("append:field",i):a.push(i.get("key"))},this),!t.hasNext()){var r=t.append({formContentData:a});t.setElement(r)}i.channel("fields").request("clear:staging")}},addField:function(e,t){var n=i.channel("fields").request("get:type",e),r=i.channel("fields").request("add",{label:n.get("nicename"),type:e});return t.getFormContentData().trigger("remove:field",r),r},changePart:function(e,t){t.next(),jQuery(e.helper).draggable()}});return e}),n("controllers/partSettings",[],function(e){var t=Marionette.Object.extend({initialize:function(){this.setupCollection(),i.channel("mp").reply("get:settingGroupCollection",this.getCollection,this)},setupCollection:function(){var e=i.channel("app").request("get:settingGroupCollectionDefinition");this.collection=new e([{id:"primary",label:"",display:!0,priority:100,settings:[{name:"title",type:"textbox",label:"Part Title",placeholder:"",width:"full",value:""}]}])},getCollection:function(){return this.collection}});return t}),n("controllers/loadControllers",["controllers/data","controllers/clickControls","controllers/gutterDroppables","controllers/partSettings"],function(e,t,n,i){var r=Marionette.Object.extend({initialize:function(){new e,new t,new n,new i}});return r}),n("views/drawerItem",[],function(){var e=Marionette.ItemView.extend({tagName:"li",template:"#nf-tmpl-mp-drawer-item",initialize:function(){this.listenTo(this.model,"change:title",this.render)},className:function(){return this.model==this.model.collection.getElement()?"active":void 0},attributes:function(){return{id:this.model.cid}},onShow:function(){var e=this;jQuery(this.el).droppable({activeClass:"mp-drag-active",hoverClass:"mp-drag-hover",accept:".nf-field-type-draggable, .nf-field-wrap, .nf-stage",tolerance:"pointer",over:function(e,t){jQuery("#nf-main").find(".nf-fields-sortable-placeholder").addClass("nf-sortable-removed").removeClass("nf-fields-sortable-placeholder"),t.item=t.draggable,jQuery(t.draggable).hasClass("nf-field-type-draggable")||jQuery(t.draggable).hasClass("nf-stage")?i.channel("app").request("over:fieldsSortable",t):jQuery(t.helper).css({width:"300px",height:"50px",opacity:"0.7"})},out:function(e,t){if(jQuery("#nf-main").find(".nf-sortable-removed").addClass("nf-fields-sortable-placeholder"),t.item=t.draggable,jQuery(t.draggable).hasClass("nf-field-type-draggable")||jQuery(t.draggable).hasClass("nf-stage"))i.channel("app").request("out:fieldsSortable",t);else{var n=i.channel("fields").request("get:sortableEl"),r=jQuery(n).width();jQuery(n).height();jQuery(t.helper).css({width:r,height:"",opacity:""})}},drop:function(t,n){n.draggable.dropping=!0,n.item=n.draggable,i.channel("app").request("out:fieldsSortable",n),jQuery(n.draggable).effect("transfer",{to:jQuery(e.el)},500),jQuery(n.draggable).hasClass("nf-field-wrap")?e.dropField(t,n):jQuery(n.draggable).hasClass("nf-field-type-draggable")?e.dropNewField(t,n):jQuery(n.draggable).hasClass("nf-stage")&&e.dropStaging(t,n)}})},events:{click:"click"},click:function(e){if(jQuery(e.target).hasClass("nf-edit")){var t=i.channel("mp").request("get:settingGroupCollection");i.channel("app").request("open:drawer","editSettings",{model:this.model,groupCollection:t})}else jQuery(e.target).hasClass("nf-duplicate")?console.log("duplicate"):jQuery(e.target).hasClass("nf-delete")?this.model.collection.remove(this.model):this.model!=this.model.collection.getElement()&&this.model.collection.setElement(this.model)},clickEditPart:function(e){console.log("click edit part")},templateHelpers:function(){var e=this;return{getIndex:function(){return e.model.collection.indexOf(e.model)+1}}},dropField:function(e,t){i.channel("fields").request("sort:fields",null,null,!1),i.channel("app").request("out:fieldsSortable",t);var n=i.channel("fields").request("get:field",jQuery(t.draggable).data("id"));this.model.collection.getFormContentData().trigger("remove:field",n),this.model.get("formContentData").trigger("append:field",n)},dropNewField:function(e,t){var n=jQuery(t.draggable).data("id"),i=this.addField(n,this.model.collection);this.model.get("formContentData").trigger("append:field",i)},dropStaging:function(e,t){i.channel("fields").request("sort:staging");var n=i.channel("fields").request("get:staging");_.each(n.models,function(e,t){var n=this.addField(e.get("slug"),this.model.collection);this.model.get("formContentData").trigger("append:field",n)},this),i.channel("fields").request("clear:staging")},addField:function(e,t){var n=i.channel("fields").request("get:type",e),r=i.channel("fields").request("add",{label:n.get("nicename"),type:e});return t.getFormContentData().trigger("remove:field",r),r}});return e}),n("views/drawerCollection",["views/drawerItem"],function(e){var t=Marionette.CollectionView.extend({tagName:"ul",childView:e,initialize:function(){var e=_.template(jQuery("#nf-tmpl-mp-drawer-pagination-left").html());this.leftPagination='<li class="no-sort">'+e()+"</li>",e=_.template(jQuery("#nf-tmpl-mp-drawer-pagination-right").html()),this.rightPagination='<li class="no-sort">'+e()+"</li>",this.listenTo(this.collection,"change:part",this.render)},onShow:function(){var e=this;jQuery(this.el).sortable({items:"li:not(.no-sort)",helper:"clone",update:function(t,n){jQuery(n.item).css("opacity","");var i=_.without(jQuery(this).sortable("toArray"),"");_.each(i,function(t,n){e.collection.get({cid:t}).set("order",n)},this),e.collection.sort()},start:function(e,t){jQuery(t.item).hasClass("nf-field-type-draggable")||jQuery(t.item).hasClass("nf-stage")||(jQuery(t.item).css("opacity","0.5").show(),jQuery(t.helper).css("opacity","0.75"))},stop:function(e,t){jQuery(t.item).hasClass("nf-field-type-draggable")||jQuery(t.item).hasClass("nf-stage")||jQuery(t.item).css("opacity","")}})},attachHtml:function(e,t,n){e.isBuffering?e._bufferedChildren.splice(n,0,t):e._insertBefore(t,n)||(jQuery(e.el).find(".no-sort").remove(),e._insertAfter(t),jQuery(e.el).prepend(this.leftPagination),jQuery(e.el).append(this.rightPagination))},attachBuffer:function(e,t){e.$el.find(".no-sort").remove(),e.$el.prepend(this.leftPagination),e.$el.append(t),e.$el.append(this.rightPagination)}});return t}),n("views/layout",["views/drawerCollection"],function(e){var t=Marionette.LayoutView.extend({tagName:"div",template:"#nf-tmpl-mp-layout",regions:{mainContent:"#nf-mp-main-content",drawer:"#nf-mp-drawer"},initialize:function(){this.listenTo(this.collection,"change:part",this.changePart)},onShow:function(){this.drawer.show(new e({collection:this.collection}));var t=i.channel("formContent").request("get:viewFilters"),n=_.without(t,void 0),r=n[1];this.formContentView=r(),0==this.collection.length&&this.collection.add({}),this.mainContent.show(new this.formContentView({collection:this.collection.getFormContentData()}))},changePart:function(){var e=this.collection.indexOf(this.collection.getElement()),t=this.collection.indexOf(this.collection.previousElement);if(e>t)var n="left",i="right";else var n="right",i="left";var r=this;jQuery(this.mainContent.el).hide("slide",{direction:n},300,function(){r.mainContent.empty(),r.mainContent.show(new r.formContentView({collection:r.collection.getFormContentData()}))}),jQuery(r.mainContent.el).show("slide",{direction:i},200)}});return t}),n("views/gutterLeft",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-mp-gutter-left",events:{"click .fa":"clickPrevious"},initialize:function(){this.collection=i.channel("mp").request("get:collection"),this.listenTo(this.collection,"change:part",this.render),this.listenTo(this.collection,"sort",this.render),this.listenTo(this.collection,"remove",this.render)},onRender:function(){var e=this;jQuery(this.el).find(".fa").droppable({tolerance:"pointer",hoverClass:"mp-circle-over",activeClass:"mp-circle-active",accept:".nf-field-type-draggable, .nf-field-wrap, .nf-stage",over:function(t,n){i.channel("mp").trigger("over:gutter",n,e.collection)},out:function(t,n){i.channel("mp").trigger("out:gutter",n,e.collection)},drop:function(t,n){i.channel("mp").trigger("drop:leftGutter",n,e.collection)}})},clickPrevious:function(e){i.channel("mp").trigger("click:previous",e)},templateHelpers:function(){var e=this;return{hasPrevious:function(){return e.collection.hasPrevious()}}},changePart:function(e){e.collection.previous()}});return e}),n("views/gutterRight",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-mp-gutter-right",events:{"click .next":"clickNext","click .new":"clickNew"},initialize:function(){this.collection=i.channel("mp").request("get:collection"),this.listenTo(this.collection,"change:part",this.render),this.listenTo(this.collection,"sort",this.render),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render),this.listenTo(i.channel("fields"),"add:field",this.render)},test:function(){console.log("test test test")},onRender:function(){var e=this;jQuery(this.el).find(".fa").droppable({tolerance:"pointer",hoverClass:"mp-circle-over",activeClass:"mp-circle-active",accept:".nf-field-type-draggable, .nf-field-wrap, .nf-stage",over:function(t,n){i.channel("mp").trigger("over:gutter",n,e.collection)},out:function(t,n){i.channel("mp").trigger("out:gutter",n,e.collection)},drop:function(t,n){i.channel("mp").trigger("drop:rightGutter",n,e.collection)}})},clickNext:function(e){i.channel("mp").trigger("click:next",e)},clickNew:function(e){i.channel("mp").trigger("click:new",e)},templateHelpers:function(){var e=this;return{hasNext:function(){return e.collection.hasNext()},hasContent:function(){return 0!=i.channel("fields").request("get:collection").length}}},changePart:function(e){e.collection.next()}});return e}),n("views/mainContentEmpty",[],function(){var e=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-mp-main-content-fields-empty",onBeforeDestroy:function(){jQuery(this.el).parent().removeClass("nf-fields-empty-droppable").droppable("destroy")},onRender:function(){this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el)},onShow:function(){jQuery(this.el).parent().hasClass("ui-sortable")&&jQuery(this.el).parent().sortable("destroy"),jQuery(this.el).parent().addClass("nf-fields-empty-droppable"),jQuery(this.el).parent().droppable({accept:function(e){return jQuery(e).hasClass("nf-stage")||jQuery(e).hasClass("nf-field-type-button")?!0:void 0},activeClass:"nf-droppable-active",hoverClass:"nf-droppable-hover",tolerance:"pointer",over:function(e,t){t.item=t.draggable,i.channel("app").request("over:fieldsSortable",t)},out:function(e,t){t.item=t.draggable,i.channel("app").request("out:fieldsSortable",t)},drop:function(e,t){t.item=t.draggable,i.channel("app").request("receive:fieldsSortable",t);var n=i.channel("fields").request("get:collection");n.trigger("reset",n)}})}});return e}),n("controllers/filters",["views/layout","views/gutterLeft","views/gutterRight","views/mainContentEmpty","models/partCollection"],function(e,t,n,r,l){var o=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("app"),"after:loadViews",this.addFilters)},addFilters:function(){i.channel("formContentGutters").request("add:leftFilter",this.getLeftView,1,this),i.channel("formContentGutters").request("add:rightFilter",this.getRightView,1,this),i.channel("formContent").request("add:viewFilter",this.getContentView,1),i.channel("formContent").request("add:saveFilter",this.formContentSave,1),i.channel("formContent").request("add:loadFilter",this.formContentLoad,1),this.emptyView()},getLeftView:function(){return t},getRightView:function(){return n},formContentLoad:function(e){if(!0==e instanceof Backbone.Collection)return e;var t=new l(e);return i.channel("mp").request("init:partCollection",t),t},getContentView:function(){return e},formContentSave:function(e){var t=i.channel("app").request("clone:collectionDeep",e),n=i.channel("formContent").request("get:saveFilters");return t.each(function(e){var t=_.without(n,void 0),i=t[1];e.set("formContentData",i(e.get("formContentData")))}),t.toJSON()},emptyView:function(){this.defaultMainContentEmptyView=i.channel("views").request("get:mainContentEmpty"),i.channel("views").reply("get:mainContentEmpty",this.getMainContentEmpty,this)},getMainContentEmpty:function(){return 1==i.channel("mp").request("get:collection").length?this.defaultMainContentEmptyView:r}});return o});var i=Backbone.Radio;t(["controllers/loadControllers","controllers/filters"],function(e,t){var n=Marionette.Application.extend({initialize:function(e){this.listenTo(i.channel("app"),"after:loadControllers",this.loadControllers)},loadControllers:function(){new e},onStart:function(){new t}}),r=new n;r.start()}),n("main",function(){})}();
//# sourceMappingURL=almond.build.js.map
//# sourceMappingURL=builder.js.map
