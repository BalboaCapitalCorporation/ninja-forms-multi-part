!function(){var t,e,n;!function(i){function o(t,e){return y.call(t,e)}function r(t,e){var n,i,o,r,l,a,c,s,u,f,h,p=e&&e.split("/"),m=C.map,d=m&&m["*"]||{};if(t&&"."===t.charAt(0))if(e){for(t=t.split("/"),l=t.length-1,C.nodeIdCompat&&b.test(t[l])&&(t[l]=t[l].replace(b,"")),t=p.slice(0,p.length-1).concat(t),u=0;u<t.length;u+=1)if(h=t[u],"."===h)t.splice(u,1),u-=1;else if(".."===h){if(1===u&&(".."===t[2]||".."===t[0]))break;u>0&&(t.splice(u-1,2),u-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((p||d)&&m){for(n=t.split("/"),u=n.length;u>0;u-=1){if(i=n.slice(0,u).join("/"),p)for(f=p.length;f>0;f-=1)if(o=m[p.slice(0,f).join("/")],o&&(o=o[i])){r=o,a=u;break}if(r)break;!c&&d&&d[i]&&(c=d[i],s=u)}!r&&c&&(r=c,a=s),r&&(n.splice(0,a,r),t=n.join("/"))}return t}function l(t,e){return function(){var n=x.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),p.apply(i,n.concat([t,e]))}}function a(t){return function(e){return r(e,t)}}function c(t){return function(e){g[t]=e}}function s(t){if(o(v,t)){var e=v[t];delete v[t],w[t]=!0,h.apply(i,e)}if(!o(g,t)&&!o(w,t))throw new Error("No "+t);return g[t]}function u(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function f(t){return function(){return C&&C.config&&C.config[t]||{}}}var h,p,m,d,g={},v={},C={},w={},y=Object.prototype.hasOwnProperty,x=[].slice,b=/\.js$/;m=function(t,e){var n,i=u(t),o=i[0];return t=i[1],o&&(o=r(o,e),n=s(o)),o?t=n&&n.normalize?n.normalize(t,a(e)):r(t,e):(t=r(t,e),i=u(t),o=i[0],t=i[1],o&&(n=s(o))),{f:o?o+"!"+t:t,n:t,pr:o,p:n}},d={require:function(t){return l(t)},exports:function(t){var e=g[t];return"undefined"!=typeof e?e:g[t]={}},module:function(t){return{id:t,uri:"",exports:g[t],config:f(t)}}},h=function(t,e,n,r){var a,u,f,h,p,C,y=[],x=typeof n;if(r=r||t,"undefined"===x||"function"===x){for(e=!e.length&&n.length?["require","exports","module"]:e,p=0;p<e.length;p+=1)if(h=m(e[p],r),u=h.f,"require"===u)y[p]=d.require(t);else if("exports"===u)y[p]=d.exports(t),C=!0;else if("module"===u)a=y[p]=d.module(t);else if(o(g,u)||o(v,u)||o(w,u))y[p]=s(u);else{if(!h.p)throw new Error(t+" missing "+u);h.p.load(h.n,l(r,!0),c(u),{}),y[p]=g[u]}f=n?n.apply(g[t],y):void 0,t&&(a&&a.exports!==i&&a.exports!==g[t]?g[t]=a.exports:f===i&&C||(g[t]=f))}else t&&(g[t]=n)},t=e=p=function(t,e,n,o,r){if("string"==typeof t)return d[t]?d[t](e):s(m(t,e).f);if(!t.splice){if(C=t,C.deps&&p(C.deps,C.callback),!e)return;e.splice?(t=e,e=n,n=null):t=i}return e=e||function(){},"function"==typeof n&&(n=o,o=r),o?h(i,t,e,n):setTimeout(function(){h(i,t,e,n)},4),p},p.config=function(t){return p(t)},t._defined=g,n=function(t,e,n){if("string"!=typeof t)throw new Error("See almond README: incorrect module build, no module name");e.splice||(n=e,e=[]),o(g,t)||o(v,t)||(v[t]=[t,e,n])},n.amd={jQuery:!0}}(),n("../lib/almond",function(){}),n("models/partModel",[],function(){var t=Backbone.Model.extend({defaults:{title:"",formContentData:[],order:0},initialize:function(){var t=i.channel("formContent").request("get:loadFilters"),e=_.without(t,void 0),n=e[1];this.set("formContentData",n(this.get("formContentData"))),this.listenTo(this.get("formContentData"),"change:order",this.sortFormContentData)},sortFormContentData:function(){this.get("formContentData").sort()}});return t}),n("models/partCollection",["models/partModel"],function(t){var e=Backbone.Collection.extend({model:t,currentElement:!1,comparator:"order",initialize:function(t,e){},getElement:function(){return this.currentElement||this.setElement(this.at(0),!0),this.currentElement},setElement:function(t,e){e=e||!1,this.currentElement=t,e||this.trigger("change:part",this)},next:function(){return this.hasNext()&&this.setElement(this.at(this.indexOf(this.getElement())+1)),this},previous:function(){return this.hasPrevious()&&this.setElement(this.at(this.indexOf(this.getElement())-1)),this},hasNext:function(){return this.length-1!=this.indexOf(this.getElement())},hasPrevious:function(){return 0!=this.indexOf(this.getElement())}});return e}),n("controllers/data",["models/partCollection"],function(t){var e=Marionette.Object.extend({initialize:function(){i.channel("mp").reply("init:partCollection",this.initPartCollection,this),i.channel("mp").reply("get:collection",this.getCollection,this),this.listenTo(i.channel("fields"),"add:field",this.addField)},initPartCollection:function(t){this.collection=t},getCollection:function(){return this.collection},addField:function(t){this.collection.getElement().get("formContentData").trigger("add:field",t)}});return e}),n("views/layout",[],function(){var t=Marionette.LayoutView.extend({tagName:"div",template:"#nf-tmpl-mp-layout",regions:{mainContent:"#nf-mp-main-content",topDrawer:"#nf-mp-top-drawer"},initialize:function(){this.listenTo(this.collection,"change:part",this.changePart)},onShow:function(){var t=i.channel("formContent").request("get:viewFilters"),e=_.without(t,void 0),n=e[1];this.formContentView=n(),this.mainContent.show(new this.formContentView({collection:this.collection.getElement().get("formContentData")}))},changePart:function(){this.mainContent.empty(),this.mainContent.show(new this.formContentView({collection:this.collection.getElement().get("formContentData")}))}});return t}),n("views/gutterLeft",[],function(){var t=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-mp-gutter-left",events:{"click .fa":"clickPrevious"},initialize:function(){this.collection=i.channel("mp").request("get:collection"),this.listenTo(this.collection,"change:part",this.render)},clickPrevious:function(t){i.channel("mp").trigger("click:previous",t)},templateHelpers:function(){var t=this;return{hasPrevious:function(){return t.collection.hasPrevious()}}}});return t}),n("views/gutterRight",[],function(){var t=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-mp-gutter-right",events:{"click .next":"clickNext","click .new":"clickNew"},initialize:function(){this.collection=i.channel("mp").request("get:collection"),this.listenTo(this.collection,"change:part",this.render)},clickNext:function(t){i.channel("mp").trigger("click:next",t)},clickNew:function(t){i.channel("mp").trigger("click:new",t)},templateHelpers:function(){var t=this;return{hasNext:function(){return t.collection.hasNext()}}}});return t}),n("views/mainContentEmpty",[],function(){var t=Marionette.ItemView.extend({tagName:"div",template:"#nf-tmpl-mp-main-content-fields-empty",onBeforeDestroy:function(){jQuery(this.el).parent().removeClass("nf-fields-empty-droppable").droppable("destroy")},onRender:function(){this.$el=this.$el.children(),this.$el.unwrap(),this.setElement(this.$el)},onShow:function(){jQuery(this.el).parent().hasClass("ui-sortable")&&jQuery(this.el).parent().sortable("destroy"),jQuery(this.el).parent().addClass("nf-fields-empty-droppable"),jQuery(this.el).parent().droppable({accept:function(t){return jQuery(t).hasClass("nf-stage")||jQuery(t).hasClass("nf-field-type-button")?!0:void 0},activeClass:"nf-droppable-active",hoverClass:"nf-droppable-hover",tolerance:"pointer",over:function(t,e){e.item=e.draggable,i.channel("app").request("over:fieldsSortable",e)},out:function(t,e){e.item=e.draggable,i.channel("app").request("out:fieldsSortable",e)},drop:function(t,e){e.item=e.draggable,i.channel("app").request("receive:fieldsSortable",e);var n=i.channel("fields").request("get:collection");n.trigger("reset",n)}})}});return t}),n("controllers/filters",["views/layout","views/gutterLeft","views/gutterRight","views/mainContentEmpty","models/partCollection"],function(t,e,n,o,r){var l=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("app"),"after:loadViews",this.addFilters)},addFilters:function(){i.channel("formContentGutters").request("add:leftFilter",this.getLeftView,1,this),i.channel("formContentGutters").request("add:rightFilter",this.getRightView,1,this),i.channel("formContent").request("add:viewFilter",this.getContentView,1),i.channel("formContent").request("add:saveFilter",this.formContentSave,1),i.channel("formContent").request("add:loadFilter",this.formContentLoad,1),this.emptyView()},getLeftView:function(){return e},getRightView:function(){return n},formContentLoad:function(t){var e=new r(t);return i.channel("mp").request("init:partCollection",e),e},getContentView:function(){return t},formContentSave:function(t){var e=i.channel("app").request("clone:collectionDeep",t),n=i.channel("formContent").request("get:saveFilters");return e.each(function(t){var e=_.without(n,void 0),i=e[1];t.set("formContentData",i(t.get("formContentData")))}),e.toJSON()},emptyView:function(){this.defaultMainContentEmptyView=i.channel("views").request("get:mainContentEmpty"),i.channel("views").reply("get:mainContentEmpty",this.getMainContentEmpty,this)},getMainContentEmpty:function(){return 0==i.channel("mp").request("get:collection").length?this.defaultMainContentEmptyView:o}});return l}),n("controllers/clickControls",[],function(){var t=Marionette.Object.extend({initialize:function(){this.listenTo(i.channel("mp"),"click:previous",this.clickPrevious),this.listenTo(i.channel("mp"),"click:next",this.clickNext),this.listenTo(i.channel("mp"),"click:new",this.clickNew)},clickPrevious:function(t){var e=i.channel("mp").request("get:collection");e.previous()},clickNext:function(t){var e=i.channel("mp").request("get:collection");e.next()},clickNew:function(t){var e=i.channel("mp").request("get:collection"),n=e.add({});e.setElement(n)}});return t}),n("controllers/loadControllers",["controllers/data","controllers/filters","controllers/clickControls"],function(t,e,n){var i=Marionette.Object.extend({initialize:function(){new t,new e,new n}});return i});var i=Backbone.Radio;e(["controllers/loadControllers"],function(t){var e=Marionette.Application.extend({initialize:function(t){this.listenTo(i.channel("app"),"after:appStart",this.afterStart)},onStart:function(){new t}}),n=new e;n.start()}),n("main",function(){})}();
//# sourceMappingURL=almond.build.js.map
//# sourceMappingURL=builder.js.map
