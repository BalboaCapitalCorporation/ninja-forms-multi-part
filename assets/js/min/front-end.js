!function(){var e,t,i;!function(n){function o(e,t){return y.call(e,t)}function r(e,t){var i,n,o,r,l,s,c,a,f,h,u,d=t&&t.split("/"),m=b.map,g=m&&m["*"]||{};if(e&&"."===e.charAt(0))if(t){for(e=e.split("/"),l=e.length-1,b.nodeIdCompat&&P.test(e[l])&&(e[l]=e[l].replace(P,"")),e=d.slice(0,d.length-1).concat(e),f=0;f<e.length;f+=1)if(u=e[f],"."===u)e.splice(f,1),f-=1;else if(".."===u){if(1===f&&(".."===e[2]||".."===e[0]))break;f>0&&(e.splice(f-1,2),f-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((d||g)&&m){for(i=e.split("/"),f=i.length;f>0;f-=1){if(n=i.slice(0,f).join("/"),d)for(h=d.length;h>0;h-=1)if(o=m[d.slice(0,h).join("/")],o&&(o=o[n])){r=o,s=f;break}if(r)break;!c&&g&&g[n]&&(c=g[n],a=f)}!r&&c&&(r=c,s=a),r&&(i.splice(0,s,r),e=i.join("/"))}return e}function l(e,t){return function(){var i=E.call(arguments,0);return"string"!=typeof i[0]&&1===i.length&&i.push(null),d.apply(n,i.concat([e,t]))}}function s(e){return function(t){return r(t,e)}}function c(e){return function(t){p[e]=t}}function a(e){if(o(v,e)){var t=v[e];delete v[e],w[e]=!0,u.apply(n,t)}if(!o(p,e)&&!o(w,e))throw new Error("No "+e);return p[e]}function f(e){var t,i=e?e.indexOf("!"):-1;return i>-1&&(t=e.substring(0,i),e=e.substring(i+1,e.length)),[t,e]}function h(e){return function(){return b&&b.config&&b.config[e]||{}}}var u,d,m,g,p={},v={},b={},w={},y=Object.prototype.hasOwnProperty,E=[].slice,P=/\.js$/;m=function(e,t){var i,n=f(e),o=n[0];return e=n[1],o&&(o=r(o,t),i=a(o)),o?e=i&&i.normalize?i.normalize(e,s(t)):r(e,t):(e=r(e,t),n=f(e),o=n[0],e=n[1],o&&(i=a(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:i}},g={require:function(e){return l(e)},exports:function(e){var t=p[e];return"undefined"!=typeof t?t:p[e]={}},module:function(e){return{id:e,uri:"",exports:p[e],config:h(e)}}},u=function(e,t,i,r){var s,f,h,u,d,b,y=[],E=typeof i;if(r=r||e,"undefined"===E||"function"===E){for(t=!t.length&&i.length?["require","exports","module"]:t,d=0;d<t.length;d+=1)if(u=m(t[d],r),f=u.f,"require"===f)y[d]=g.require(e);else if("exports"===f)y[d]=g.exports(e),b=!0;else if("module"===f)s=y[d]=g.module(e);else if(o(p,f)||o(v,f)||o(w,f))y[d]=a(f);else{if(!u.p)throw new Error(e+" missing "+f);u.p.load(u.n,l(r,!0),c(f),{}),y[d]=p[f]}h=i?i.apply(p[e],y):void 0,e&&(s&&s.exports!==n&&s.exports!==p[e]?p[e]=s.exports:h===n&&b||(p[e]=h))}else e&&(p[e]=i)},e=t=d=function(e,t,i,o,r){if("string"==typeof e)return g[e]?g[e](t):a(m(e,t).f);if(!e.splice){if(b=e,b.deps&&d(b.deps,b.callback),!t)return;t.splice?(e=t,t=i,i=null):e=n}return t=t||function(){},"function"==typeof i&&(i=o,o=r),o?u(n,e,t,i):setTimeout(function(){u(n,e,t,i)},4),d},d.config=function(e){return d(e)},e._defined=p,i=function(e,t,i){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(i=t,t=[]),o(p,e)||o(v,e)||(v[e]=[e,t,i])},i.amd={jQuery:!0}}(),i("../lib/almond",function(){}),i("views/header",[],function(){var e=Marionette.ItemView.extend({template:"#nf-tmpl-mp-header",fullProgressBar:!1,initialize:function(e){this.listenTo(this.collection,"change:part",this.reRender),this.listenTo(this.collection,"change:errors",this.reRender),this.listenTo(n.channel("forms"),"before:submit",this.fillProgressBar)},reRender:function(){this.model=this.collection.getElement(),this.render()},templateHelpers:function(){var e=this;return{renderPartTitle:function(){if("undefined"==typeof e.collection.formModel.get("settings").mp_showtitles||0==e.collection.formModel.get("settings").mp_showtitles)return"";var t=_.template(jQuery("#nf-tmpl-mp-part-title").html()),i=_.invoke(e.collection.getVisibleParts(),"pick",["title","errors","visible"]);return 1<i.length?t({title:this.title}):""},renderBreadcrumbs:function(){if("undefined"==typeof e.collection.formModel.get("settings").mp_breadcrumbs||0==e.collection.formModel.get("settings").mp_breadcrumbs)return"";var t=_.template(jQuery("#nf-tmpl-mp-breadcrumbs").html()),i=_.invoke(e.collection.getVisibleParts(),"pick",["title","errors","visible"]);return 1<i.length?t({parts:i,currentIndex:e.collection.getVisibleParts().indexOf(e.model)}):""},renderProgressBar:function(){if("undefined"==typeof e.collection.formModel.get("settings").mp_progressbar||0==e.collection.formModel.get("settings").mp_progressbar)return"";var t=_.template(jQuery("#nf-tmpl-mp-progress-bar").html()),i=e.collection.getVisibleParts().indexOf(e.model),n=e.fullProgressBar?100:i/e.collection.getVisibleParts().length*100;return 1<e.collection.getVisibleParts().length?t({percent:n}):""}}},events:{"click .nf-breadcrumb":"clickBreadcrumb"},clickBreadcrumb:function(e){e.preventDefault(),this.collection.setElement(this.collection.getVisibleParts()[jQuery(e.target).data("index")])},fillProgressBar:function(e){this.fullProgressBar=!0,this.render(),this.fullProgressBar=!1}});return e}),i("views/footer",[],function(){var e=Marionette.ItemView.extend({template:"#nf-tmpl-mp-footer",initialize:function(e){this.listenTo(this.collection,"change:part",this.reRender)},reRender:function(){this.model=this.collection.getElement(),this.render()},templateHelpers:function(){var e=this;return{renderNextPrevious:function(){var t=_.template(jQuery("#nf-tmpl-mp-next-previous").html()),i=!1,n=!1,o=e.collection.where({visible:!0});return o.indexOf(e.model)!=o.length-1&&(i=!0),0!=o.indexOf(e.model)&&(n=!0),i||n?t({showNext:i,showPrevious:n}):""}}}});return e}),i("views/formContent",["views/header","views/footer"],function(e,t){var i=Marionette.LayoutView.extend({template:"#nf-tmpl-mp-form-content",regions:{header:".nf-mp-header",body:".nf-mp-body",footer:".nf-mp-footer"},initialize:function(e){this.formModel=e.formModel,this.collection=e.data,this.listenTo(this.collection,"change:part",this.changePart),this.listenTo(this.collection,"change:visible",this.renderHeaderFooter)},onRender:function(){this.header.show(new e({collection:this.collection,model:this.collection.getElement()}));var i=n.channel("formContent").request("get:viewFilters"),o=_.without(i,void 0),r=o[1];this.formContentView=r(),this.body.show(new this.formContentView({collection:this.collection.getElement().get("formContentData")})),this.footer.show(new t({collection:this.collection,model:this.collection.getElement()}))},renderHeaderFooter:function(){this.header.show(new e({collection:this.collection,model:this.collection.getElement()})),this.footer.show(new t({collection:this.collection,model:this.collection.getElement()}))},changePart:function(){this.body.show(new this.formContentView({collection:this.collection.getElement().get("formContentData")}));var e=jQuery(this.body.el).closest(".nf-form-cont").offset().top;jQuery(window).scrollTop()>e-50&&jQuery(window).scrollTop(e-50)},events:{"click .nf-next":"clickNext","click .nf-previous":"clickPrevious"},clickNext:function(e){e.preventDefault(),this.collection.next()},clickPrevious:function(e){e.preventDefault(),this.collection.previous()}});return i}),i("models/partModel",[],function(){var e=Backbone.Model.extend({fieldErrors:{},defaults:{errors:!1,visible:!0,title:""},initialize:function(){this.filterFormContentData(),this.listenTo(this.get("formContentData"),"change:errors",this.maybeChangeActivePart),this.fieldErrors[this.cid]=[],this.on("change:visible",this.changeVisible,this)},filterFormContentData:function(){if(this.get("formContentData")){var e=this.get("formContentData"),t=n.channel("formContent").request("get:loadFilters"),i=_.without(t,void 0),o=i[1],r=0==e.length?!0:!1;if("undefined"==typeof t[4]&&_.isArray(e)&&0!=e.length&&"undefined"!=typeof e[0].cells){var l=[],s=_.pluck(e,"cells");_.each(s,function(e){var t=_.flatten(_.pluck(e,"fields"));l=_.union(l,t)}),e=l,this.set("formContentData",e)}this.set("formContentData",o(e,this.collection.formModel,r,e))}},maybeChangeActivePart:function(e){0<e.get("errors").length?(this.set("errors",!0),this.fieldErrors[this.cid].push(e.get("key")),this.collection.getElement()!=this&&this.collection.indexOf(this.collection.getElement())>this.collection.indexOf(this)&&this.collection.setElement(this)):(this.fieldErrors[this.cid]=_.without(this.fieldErrors[this.cid],e.get("key")),0==this.fieldErrors[this.cid].length&&this.set("errors",!1))},validateFields:function(){this.get("formContentData").validateFields()},changeVisible:function(){this.get("visible")?this.get("formContentData").showFields():this.get("formContentData").hideFields()}});return e}),i("models/partCollection",["models/partModel"],function(e){var t=Backbone.Collection.extend({model:e,currentElement:!1,initialize:function(e,t){this.formModel=t.formModel},getElement:function(){return this.currentElement||this.setElement(this.at(0),!0),this.currentElement},setElement:function(e,t){t=t||!1,(t||!this.partErrors())&&(this.currentElement=e,t||this.trigger("change:part",this))},next:function(){return this.getVisibleParts().length-1!=this.getVisibleParts().indexOf(this.getElement())&&this.setElement(this.getVisibleParts()[this.getVisibleParts().indexOf(this.getElement())+1]),this},previous:function(){return 0!=this.getVisibleParts().indexOf(this.getElement())&&this.setElement(this.getVisibleParts()[this.getVisibleParts().indexOf(this.getElement())-1]),this},partErrors:function(){return"undefined"==typeof this.formModel.get("settings").mp_validate||0==this.formModel.get("settings").mp_validate?!1:(this.currentElement.validateFields(),this.currentElement.get("errors"))},validateFields:function(){_.each(this.getVisibleParts(),function(e){e.validateFields()})},getVisibleParts:function(){return this.where({visible:!0})}});return t}),i("controllers/loadFilters",["views/formContent","models/partCollection"],function(e,t){var i=Marionette.Object.extend({initialize:function(){n.channel("formContent").request("add:viewFilter",this.getformContentView,1),n.channel("formContent").request("add:loadFilter",this.formContentLoad,1)},getformContentView:function(t){return e},formContentLoad:function(e,i){if(!0==e instanceof t)return e;if(_.isArray(e)&&0!=_.isArray(e).length&&"undefined"!=typeof _.first(e)&&"part"==_.first(e).type)var n=new t(e,{formModel:i});else var n=new t({formContentData:e},{formModel:i});return n}});return i}),i("controllers/conditionalLogic",[],function(){var e=Marionette.Object.extend({initialize:function(){n.channel("condition:trigger").reply("show_part",this.showPart,this),n.channel("condition:trigger").reply("hide_part",this.hidePart,this)},showPart:function(e,t){this.changePartVisibility(e,t,!0)},hidePart:function(e,t){this.changePartVisibility(e,t,!1)},changePartVisibility:function(e,t,i){var n=e.collection.formModel.get("formContentData");n.findWhere({key:t.key}).set("visible",i)}});return e}),i("controllers/loadControllers",["controllers/conditionalLogic"],function(e){var t=Marionette.Object.extend({initialize:function(){new e}});return t});var n=Backbone.Radio;t(["controllers/loadFilters","controllers/loadControllers"],function(e,t){var i=Marionette.Application.extend({initialize:function(e){this.listenTo(n.channel("form"),"before:filterData",this.loadFilters),this.listenTo(n.channel("form"),"loaded",this.loadControllers)},loadFilters:function(t){new e},loadControllers:function(e){new t},onStart:function(){}}),o=new i;o.start()}),i("main",function(){})}();
//# sourceMappingURL=almond.build.js.map
//# sourceMappingURL=front-end.js.map
